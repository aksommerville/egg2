# egg2

2025-03-12: I'd been working on this for about a month and accidentally deleted it all.
Nice one, Andy. Don't do that again.
For reference, here's what we had before the deletion:
- Custom build tool with multiple arbitrary targets.
- Abstract data conversion.
- Most of the native synthesizer: FM, Sub, and Drum voices. Post pipes. Note and Wheel events.
- Platform API defined, headers only. Single render call with GPU-ready vertex buffer. Optional mouse, keyboard, and touch events.
- Many data formats defined: ROM, metadata, strings, map, cmdlist, tilesheet, decalsheet, EAU, EAU-Text
- Test harness.

Planned differences from Egg v1:
- Custom build tool, similar to berry. Arbitrary targets selected at eggdev's build time, and web is not special.
- Direct access to data conversion a la carte via eggdev.
- Synth: Post pipes, LFOs, and stereo output.
- More input options: Keyboard, mouse, touch. Maybe accelerometer?
- Single render call taking a struct of uniforms and a GPU-ready vertex buffer.
- No image decoder at runtime (egg 1 used to do this; it's actually been removed already).
- Rich built-in menu. Quit, input config, toggle music, toggle sound, language.
- Web apps pack to a Zip file with boilerplate HTML and the binary ROM. Same as berry. Also continue to allow standalone HTML as an option.
- eggdev --help reads from etc/doc/eggdev-cli.md directly.
- Default instruments live somewhere in the SDK.
- No Wasm runtime for native builds. If we want that in the future, it should be achievable but I don't expect to want it.

# TODO

- [x] Define data formats.
- - [x] EAU
- [x] Build config.
- [x] Test harness.
- [x] Zip utility unit.
- [x] eggdev
- - [x] Generic outer layers.
- - [x] build
- - [x] minify
- - [x] serve
- - [x] convert
- - [x] config
- - [x] metadata
- - [x] unpack
- - [x] pack
- - [x] list
- - [x] run: Same as build, but after a success launch the native executable. (update the project wizard's makefile too)
- - [x] dump: Convenience to extract one resource from a ROM and dump it.
- [ ] Native runtime.
- - [x] Load.
- - [x] Pick language.
- - [x] Event queue.
- - [x] Synth.
- - - [x] Data converters.
- - - [x] Global orchestration, song player, etc.
- - - [x] FM channel
- - - [x] Drum channel
- - - [x] Sub channel
- - - [x] Post
- - [x] Render.
- - - [x] Even though we don't need it yet, confirm everything works with `render_texture.border` before moving on.
- - - - ...tried. Not certain it actually did anything, but all seems in order i guess.
- - - [x] TILE and FANCY shaders.
- - - [x] FANCY probably needs an xform too.
- - [ ] Input.
- - - [x] Device mapping.
- - - [ ] Persist mappings.
- - - [x] egg_gamepad_get_button: Need to cache full capability reports in inmgr.
- - - [ ] Interactive reconfig.
- - - - [ ] Let the client declare which buttons it uses, so when configuring we don't ask for all 15 buttons.
- - - - - Maybe a metadata field "incfgMask" containing characters "dswne123lrLR". "d" being the dpad, all others correspond to one button.
- - [x] Persistence.
- - [ ] Record and playback session.
- [ ] Web runtime.
- - [x] Load binary.
- - [x] Load base64.
- - [ ] Synth.
- - [x] Render.
- - [ ] Input.
- - - [x] Keyboard.
- - - [ ] Pointer.
- - - [ ] Gamepad.
- - - [ ] Fine-grained events.
- - - [ ] Mapping.
- - - [ ] Live config.
- - [x] Persistence.
- - [ ] prefs
- [ ] Editor.
- - [ ] `eggdev project`: Prep overrides.
- - [x] Basic plumbing: Injector, Dom, modals, bootstrap.
- - [x] TextEditor and HexEditor.
- - [x] MetadataEditor - nah text is fine
- - [x] StringsEditor - ''
- - [x] ImageEditor: For now just show the image.
- - [x] TilesheetEditor
- - [x] DecalsheetEditor
- - [x] SpriteEditor
- - [x] MapEditor
- - - [x] Selection
- - - [x] POI
- - - [x] Actions
- - - [x] Neighbors
- - [x] SongEditor
- - - [x] Post
- - [x] Acquire shared symbols.
- - [ ] Standard actions... what's needed?
- - [ ] Verify overrides
- [ ] Client utilities.
- - [ ] stdlib
- - [ ] graf
- - [ ] font
- Minor things punted:
- - [ ] Loop position in MIDI.
- - [ ] Also need to manage loop in editor Song.
- - [ ] WAV from EAU, can we get rate and chanc from the caller somehow?
- - [ ] System language, for MacOS and Windows.
- - [ ] Expose a GM names service, using text ripped from eggdev/instruments.eaut dynamically. <-- have it for instruments in editor... can we get drums too?
- - [ ] synth: Brief blackout on song transitions? Not sure whether it's needed.
- - [ ] Decide whether to allow WAV for sound resources.
- - [ ] Add phase to FM LFO. I think. Maybe?
- - [ ] FM pitch wheel.
- - [ ] FM: Should we adjust the modulator too, when pitchenv in play? Currently keeping it fixed.
- - [ ] Finish default instruments and drums. Punt until there's a good editor with MIDI-In.
- - [ ] eggdev_main_project.c:gen_makefile(): Serve editor and overrides.
- - [ ] HexEditor: Paging, offset, ASCII, multi-byte edits.
- - [ ] ImageEditor: Animation preview like we had in v1.
- - [ ] StringsEditor: Side-by-side editing across languages, like we had in v1.
- - [x] SidebarUi: Persist open panels.
- - [x] TilesheetEditor: Persist toolbar.
- - [ ] DecalsheetEditor: Validation.
- - [ ] Generic command list support. Can we read a command schema off a comment in shared_symbols.h?
- - [ ] POI icons for sprite and custom overrides.
- - [ ] SongEditor: Playback (From SongEditor top, and also within ModecfgDrumModal)
- - [ ] SongEditor: Live MIDI-In. Requires web synthesizer.
- - [x] SongEditor: Channel names per MIDI file.
- - [x] SongEditor: Preserve payload where possible on a channel mode change.
- - [ ] SongEditor:WaveUi: Have wave preview printed by synthesizer. Currently calling out to the server for each render.
- - [x] SongEditor:EnvUi: Place new points proportionately in the alternate line.
- - [ ] SongEditor: Must be able to change order of post steps.
- - [ ] native inmgr: Select player
- - [ ] native inmgr: map/unmap as event masks change
- - [ ] eggdev build: Replace `<title>` in HTMLs.
- - [ ] web: Detect loss of focus. At a minimum, pause audio. Maybe pause everything?
- - [ ] web Video: Load raw pixels with non-minimum stride
- - [ ] web `egg_texture_get_pixels`
- - [ ] web Video: Determine whether border is necessary. Apply to main fb as needed too; right now it's only situated for id>1 textures.
- - [ ] web: Quantize final scale-up, don't use `object-fit:contain`. Then implement `egg_video_fb_from_screen`
- - [ ] web: Player count 
